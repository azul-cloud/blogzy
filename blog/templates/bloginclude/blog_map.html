<script type="text/javascript"
  src="https://maps.googleapis.com/maps/api/js?key={{ google_api_key }}">
</script>
<script type="text/javascript">
  function initialize() {
    {% if center_lat and center_long %}
        center_latlng = new google.maps.LatLng({{ center_lat }}, {{ center_long }})
    {% else %}
        center_latlng = new google.maps.LatLng(6.230833, -75.590556)
    {% endif %}

    LocationData = [
        {% for p in blog.post_set.all %}
            {% if p.lat and p.long %}
                [{{ p.lat }},
                {{ p.long }},
                "{{ p }}",
                "{{ p.headline }}",
                "{{ p.get_absolute_url }}",
                "{% if p.image%}{{ p.image.url }}{% endif %}"]
            {% endif %}
        {% endfor %}
    ]

    var mapOptions = {
      center: center_latlng,
      zoom: 4
    };
    var map = new google.maps.Map(document.getElementById("map-canvas"),
        mapOptions);

    var infowindow = new google.maps.InfoWindow({
        maxWidth: 300,
    });

    for (var i in LocationData)
    {
        var p = LocationData[i];
        var latlng = new google.maps.LatLng(p[0], p[1]);

        var marker = new google.maps.Marker({
            position: latlng,
            map: map,
            icon: '/static/img/map_icon_sm.png',
            title: p[2],
            headline: p[3],
            link: p[4],
            imgURL: p[5],
        });

        google.maps.event.addListener(marker, 'click', function() {
            content = "<a class='brand-light' href='" + this.link + "'><h3 class='infowindow-title'>" +
                this.title + "</h3><img class='img-responsive' src='" + this.imgURL + "' /></a> " +
                "<h4 class='text-center skinny'>" + this.headline + "</p>"

            infowindow.setContent(content);
            infowindow.open(map, this);
        });
    }
  }

  google.maps.event.addDomListener(window, 'load', initialize);
</script>
